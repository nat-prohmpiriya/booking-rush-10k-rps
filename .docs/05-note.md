# à¸­à¸­à¸à¹€à¸ªà¸µà¸¢à¸‡à¹à¸šà¸šà¸™à¸µà¹‰à¸„à¸£à¸±à¸š:

  | Pattern       | à¸­à¸­à¸à¹€à¸ªà¸µà¸¢à¸‡         | à¸„à¸§à¸²à¸¡à¸«à¸¡à¸²à¸¢
                   |
  |---------------|------------------|--------------------------
  ------------------|
  | Orchestration | à¸­à¸­-à¹€à¸„à¸ª-à¹€à¸—à¸£-à¸Šà¸±à¹ˆà¸™  | à¸à¸²à¸£à¸„à¸§à¸šà¸„à¸¸à¸¡à¹à¸šà¸šà¸§à¸‡à¸­à¸­à¹€à¸„à¸ªà¸•à¸£à¸²
  (à¸¡à¸µà¸§à¸²à¸—à¸¢à¸à¸£à¸„à¸¸à¸¡)       |
  | Choreography  | à¸„à¸­-à¸£à¸µ-à¸­à¸­à¸-à¸à¸£à¸°-à¸Ÿà¸µ | à¸à¸²à¸£à¹€à¸•à¹‰à¸™à¸£à¸³à¹à¸šà¸šà¸­à¸­à¸à¹à¸šà¸šà¸—à¹ˆà¸²
  (à¹€à¸•à¹‰à¸™à¹€à¸­à¸‡à¸•à¸²à¸¡ pattern) |

  à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸šà¸‡à¹ˆà¸²à¸¢à¹†

  Orchestration ğŸ» = à¸§à¸‡à¸­à¸­à¹€à¸„à¸ªà¸•à¸£à¸²
  - à¸¡à¸µ conductor (à¸§à¸²à¸—à¸¢à¸à¸£) à¸„à¸­à¸¢à¸ªà¸±à¹ˆà¸‡à¸§à¹ˆà¸²à¹ƒà¸„à¸£à¹€à¸¥à¹ˆà¸™à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸«à¸£à¹ˆ
  - à¸—à¸¸à¸à¸„à¸™à¸—à¸³à¸•à¸²à¸¡ conductor

  Choreography ğŸ’ƒ = à¸à¸²à¸£à¹€à¸•à¹‰à¸™à¸£à¸³
  - à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¸™à¸ªà¸±à¹ˆà¸‡ à¹à¸•à¹ˆà¸—à¸¸à¸à¸„à¸™ à¸£à¸¹à¹‰à¸—à¹ˆà¸²à¹€à¸•à¹‰à¸™à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡
  - à¸à¸­à¹€à¸«à¹‡à¸™ signal à¸à¹‡à¸—à¸³à¸•à¹ˆà¸­à¹€à¸­à¸‡

  ---
  à¹ƒà¸™à¹‚à¸›à¸£à¹€à¸ˆà¸„à¹€à¸£à¸² Orchestrator à¸„à¸·à¸­ "à¸§à¸²à¸—à¸¢à¸à¸£" à¸—à¸µà¹ˆà¸ªà¸±à¹ˆà¸‡:
  1. "Booking Service - à¸ˆà¸­à¸‡à¸—à¸µà¹ˆà¸™à¸±à¹ˆà¸‡!"
  2. "Payment Service - à¸•à¸±à¸”à¹€à¸‡à¸´à¸™!"
  3. "Notification - à¸ªà¹ˆà¸‡à¸­à¸µà¹€à¸¡à¸¥!"
# ============================================================
# Saga Pattern à¸¡à¸µ 2 à¹à¸šà¸šà¸«à¸¥à¸±à¸à¹†:

  Saga Pattern Types

  1. Orchestration (à¸—à¸µà¹ˆà¹€à¸£à¸²à¹ƒà¸Šà¹‰) ğŸ¯

                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  Orchestrator   â”‚  â† Central coordinator
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â–¼                 â–¼                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Step 1  â”‚      â”‚ Step 2  â”‚      â”‚ Step 3  â”‚
        â”‚ Reserve â”‚ â”€â”€â”€â–º â”‚ Payment â”‚ â”€â”€â”€â–º â”‚ Confirm â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  - à¸¡à¸µ central controller à¸„à¸­à¸¢à¸ªà¸±à¹ˆà¸‡à¸à¸²à¸£à¸—à¸¸à¸ step
  - Orchestrator à¸£à¸¹à¹‰ flow à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
  - à¸‡à¹ˆà¸²à¸¢à¸•à¹ˆà¸­à¸à¸²à¸£ debug à¹à¸¥à¸° monitor
  - à¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸š: Complex flows, à¸•à¹‰à¸­à¸‡à¸à¸²à¸£ visibility à¸ªà¸¹à¸‡

  2. Choreography (à¸­à¸µà¸à¹à¸šà¸š)

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Step 1  â”‚ â”€â”€â”€â–º â”‚ Step 2  â”‚ â”€â”€â”€â–º â”‚ Step 3  â”‚
        â”‚ Reserve â”‚      â”‚ Payment â”‚      â”‚ Confirm â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚                â”‚                â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      Event Bus (Kafka)
  - à¹„à¸¡à¹ˆà¸¡à¸µ central controller - à¹à¸•à¹ˆà¸¥à¸° service à¸Ÿà¸±à¸‡ events à¹à¸¥à¹‰à¸§à¸—à¸³à¸•à¹ˆà¸­à¹€à¸­à¸‡
  - Decoupled à¸¡à¸²à¸à¸à¸§à¹ˆà¸²
  - à¸¢à¸²à¸à¸•à¹ˆà¸­à¸à¸²à¸£ debug (distributed)
  - à¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸š: Simple flows, à¸•à¹‰à¸­à¸‡à¸à¸²à¸£ loose coupling

  ---
  à¸—à¸³à¹„à¸¡à¹€à¸£à¸²à¹€à¸¥à¸·à¸­à¸ Orchestration?

  à¸ªà¸³à¸«à¸£à¸±à¸š Booking Rush (10k RPS) à¹€à¸¥à¸·à¸­à¸ Orchestration à¹€à¸à¸£à¸²à¸°:

  1. Booking flow à¸‹à¸±à¸šà¸‹à¹‰à¸­à¸™ - Reserve â†’ Pay â†’ Confirm à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™
  sequence
  2. à¸•à¹‰à¸­à¸‡à¸à¸²à¸£ compensation à¸—à¸µà¹ˆà¸Šà¸±à¸”à¹€à¸ˆà¸™ - à¸–à¹‰à¸² payment fail à¸•à¹‰à¸­à¸‡ release
  seats à¸—à¸±à¸™à¸—à¸µ
  3. Visibility à¸ªà¸³à¸„à¸±à¸ - à¸•à¹‰à¸­à¸‡à¸£à¸¹à¹‰à¸§à¹ˆà¸² booking à¸­à¸¢à¸¹à¹ˆ state à¹„à¸«à¸™
  4. Easier to debug - à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸›à¸±à¸à¸«à¸²à¸ªà¸²à¸¡à¸²à¸£à¸– trace à¹„à¸”à¹‰à¸‡à¹ˆà¸²à¸¢

  à¹ƒà¸™ pkg/saga/ à¸—à¸µà¹ˆà¸ªà¸£à¹‰à¸²à¸‡à¹„à¸›:
  - orchestrator.go = Central coordinator
  - state.go = State machine (CREATED â†’ RESERVED â†’ PAID â†’
  CONFIRMED)
# ============================================================
# STEP TEST
## setup stripe cli
### Login
stripe login
### Forward webhooks to localhost
stripe listen --forward-to localhost:8080/api/v1/webhooks/stripe
##  strip credit card
âº Stripe Test Cards à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸”à¸ªà¸­à¸šà¸„à¸£à¸±à¸š:

  à¸šà¸±à¸•à¸£à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸™:
  | Card Number         | Description           |
  |---------------------|-----------------------|
  | 4242 4242 4242 4242 | Visa - à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹€à¸ªà¸¡à¸­       |
  | 5555 5555 5555 4444 | Mastercard - à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹€à¸ªà¸¡à¸­ |

  à¸šà¸±à¸•à¸£à¸—à¸µà¹ˆà¸–à¸¹à¸à¸›à¸à¸´à¹€à¸ªà¸˜:
  | Card Number         | Error              |
  |---------------------|--------------------|
  | 4000 0000 0000 0002 | Card declined      |
  | 4000 0000 0000 9995 | Insufficient funds |
  | 4000 0000 0000 9987 | Lost card          |
  | 4000 0000 0000 0069 | Expired card       |

  à¸•à¹‰à¸­à¸‡à¸à¸²à¸£ 3D Secure:
  | Card Number         | Description            |
  |---------------------|------------------------|
  | 4000 0025 0000 3155 | 3DS required - à¸ˆà¸°à¸œà¹ˆà¸²à¸™    |
  | 4000 0000 0000 3220 | 3DS required - à¸ˆà¸° fail |

  à¹ƒà¸Šà¹‰à¸à¸±à¸šà¸—à¸¸à¸ test card:
  - Expiration: à¸­à¸™à¸²à¸„à¸•à¹ƒà¸”à¸à¹‡à¹„à¸”à¹‰ à¹€à¸Šà¹ˆà¸™ 12/26
  - CVC: à¹€à¸¥à¸‚ 3 à¸«à¸¥à¸±à¸à¹ƒà¸”à¸à¹‡à¹„à¸”à¹‰ à¹€à¸Šà¹ˆà¸™ 123
  - ZIP: à¹€à¸¥à¸‚à¹ƒà¸”à¸à¹‡à¹„à¸”à¹‰ à¹€à¸Šà¹ˆà¸™ 10110

# ============================================================
# INFRASTRUCTURE NOTES
# ============================================================

## Kafka/Redpanda Topics

### Required Topics
à¸•à¹‰à¸­à¸‡à¸ªà¸£à¹‰à¸²à¸‡ Kafka topics à¸à¹ˆà¸­à¸™ deploy à¸«à¸£à¸·à¸­à¸à¹ˆà¸­à¸™à¸£à¸±à¸™ load test:

```bash
# à¸ªà¸£à¹‰à¸²à¸‡ booking-events topic
docker exec booking-rush-redpanda rpk topic create booking-events --partitions 3 --replicas 1

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š topics
docker exec booking-rush-redpanda rpk topic list
```

### à¸—à¸³à¹„à¸¡à¸•à¹‰à¸­à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸­à¸‡?
à¹à¸¡à¹‰à¸§à¹ˆà¸² `auto_create_topics_enabled = true` à¹à¸•à¹ˆ:
1. **Producer timeout** - franz-go library à¸à¸¢à¸²à¸¢à¸²à¸¡ 4 à¸„à¸£à¸±à¹‰à¸‡à¹à¸¥à¹‰à¸§à¸«à¸¢à¸¸à¸” à¸à¹ˆà¸­à¸™à¸—à¸µà¹ˆ Redpanda à¸ˆà¸° auto-create à¹€à¸ªà¸£à¹‡à¸ˆ
2. **Race condition** - à¸«à¸¥à¸²à¸¢ requests à¸à¸¢à¸²à¸¢à¸²à¸¡ create à¸à¸£à¹‰à¸­à¸¡à¸à¸±à¸™ â†’ metadata refresh à¸Šà¹‰à¸²
3. **Best Practice** - Production à¸„à¸§à¸£à¸ªà¸£à¹‰à¸²à¸‡ topic à¸¥à¹ˆà¸§à¸‡à¸«à¸™à¹‰à¸² (pre-create) à¹€à¸à¸·à¹ˆà¸­à¸à¸³à¸«à¸™à¸” partitions/replicas

### Error à¸—à¸µà¹ˆà¹€à¸ˆà¸­à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ topic:
```
UNKNOWN_TOPIC_OR_PARTITION: This server does not host this topic-partition
```

### Topics à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸¡à¸µ:
| Topic | Partitions | Replicas | Description |
|-------|------------|----------|-------------|
| booking-events | 3 | 1 | Booking lifecycle events (created, confirmed, cancelled, expired) |

## Redis Sync

à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸ reset à¸«à¸£à¸·à¸­ restart à¸•à¹‰à¸­à¸‡ sync inventory à¸ˆà¸²à¸ DB â†’ Redis:

```bash
# Login à¹€à¸›à¹‡à¸™ organizer
curl -s http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"organizer@test.com","password":"Test123!"}' | jq

# Sync inventory (à¹ƒà¸Šà¹‰ token à¸ˆà¸²à¸ login)
curl -s -X POST http://localhost:8080/api/v1/admin/sync-inventory \
  -H "Authorization: Bearer <TOKEN>" \
  -H "Content-Type: application/json"
```

### à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š sync status:
```bash
# à¹€à¸Šà¹‡à¸„ Redis
docker exec booking-rush-redis redis-cli -a redis123 GET "zone:availability:b0000000-0000-0001-0001-000000000000"

# à¹€à¸Šà¹‡à¸„ DB
docker exec booking-rush-postgres psql -U postgres -d ticket_db -c \
  "SELECT available_seats FROM seat_zones WHERE id = 'b0000000-0000-0001-0001-000000000000';"
```

à¸„à¹ˆà¸²à¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡à¸•à¹‰à¸­à¸‡à¸•à¸£à¸‡à¸à¸±à¸™ (à¹€à¸Šà¹ˆà¸™ 250000)